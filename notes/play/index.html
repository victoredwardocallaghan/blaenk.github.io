<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Play - Blaenk Denum</title>
  <meta name="author" content="Jorge Israel Peña">
  <meta name="description" content="AKA Blaenk Denum">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/favicon.png" rel="shortcut icon">
  <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Merriweather:900italic,900,700italic,400italic,700,400,300italic,300' rel='stylesheet' type='text/css'>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
  <link href='/css/screen.css' rel='stylesheet' type='text/css' media='screen' />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src='/js/blaenk.js' type='text/javascript'></script>
</head>
<body>
  <div class="wrapper">
    <header id="header" class="inner">
      <div id="stamp">
        <h1><a href="/">Jorge Israel Peña</a></h1>
        <h4>AKA BLAENK DENUM</h4>
      </div>
      <nav id="main-nav">
        <ul class="main">
          <li><a href="/about/">About</a></li>
          <li><a href="/work/">Work</a></li>
          <li><a href="/lately/">Lately</a></li>
          <li><a href="/notes/">Notes</a></li>
          <li><a id="search_btn">Search</a></li>
        </ul>
      </nav>
      <nav id="mobile-nav">
        <div class="alignleft menu">
          <a class="button">Menu</a>
          <div class="container">
            <ul class="main">
              <li><a href="/about/">About</a></li>
              <li><a href="/work/">Work</a></li>
              <li><a href="/lately/">Lately</a></li>
              <li><a href="/notes/">Notes</a></li>
              <li><a id="search_btn">Search</a></li>
            </ul>
          </div>
        </div>
        <div class="alignright search">
          <a class="button"></a>
          <div class="container">
            <form action="http://google.com/search" method="get">
              <input type="text" name="q" results="0">
              <input type="hidden" name="q" value="site:blaenkdenum.com">
            </form>
          </div>
        </div>
      </nav>
    </header>
    <div id="content" class="inner">
      <form class="desk_search" action="http://google.com/search" method="get">
        <input id="search" type="text" name="q" results="0" placeholder="Search" autocomplete="off" spellcheck="false">
        <input type="hidden" name="q" value="site:blaenkdenum.com">
      </form>
      <article class="post">
  <h2 class="title"><a href="/notes/play/"><span>Play</span></a></h2>
  <div class="entry-content"><p>So I’ve <a href="/notes/scala/">learned</a> Scala the language, and now I think it’s time to learn <a href="http://www.playframework.com/">Play</a>, a popular web framework for it. There is also a browsable <a href="http://www.playframework.com/documentation/2.0.x/api/scala/index.html#package">API documentation</a>.</p>
<nav id="toc"><p>Contents</p><ol><li><a href="#command">Command</a></li><li><a href="#configuration">Configuration</a><ol><li><a href="#routing">Routing</a></li></ol></li><li><a href="#models">Models</a><ol><li><a href="#persistence">Persistence</a></li></ol></li><li><a href="#views">Views</a><ol><li><a href="#escaping">Escaping</a></li><li><a href="#includes">Includes</a></li><li><a href="#layouts">Layouts</a></li><li><a href="#localization">Localization</a></li></ol></li><li><a href="#controllers">Controllers</a><ol><li><a href="#session">Session</a></li><li><a href="#assets">Assets</a></li></ol></li></ol></nav>
<h1 id="command">Command</h1>
<p>The <code>play</code> command is similar to the <code>rails</code> command. The <code>new</code> option bootstraps a simple application with the following directory structure:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Directory</th>
<th style="text-align: left;">Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">app</td>
<td style="text-align: left;">application source</td>
</tr>
<tr class="even">
<td style="text-align: left;">conf</td>
<td style="text-align: left;">configuration files/data</td>
</tr>
<tr class="odd">
<td style="text-align: left;">project</td>
<td style="text-align: left;">project build scripts</td>
</tr>
<tr class="even">
<td style="text-align: left;">public</td>
<td style="text-align: left;">static files</td>
</tr>
<tr class="odd">
<td style="text-align: left;">test</td>
<td style="text-align: left;">tests</td>
</tr>
</tbody>
</table>
<p>The <code>run</code> option starts the Play server and runs the application. Specifying it as <code>~run</code> performs compilation as files are modified, whereas regular <code>run</code> recompiles upon the next HTTP request.</p>
<p>Running <code>play</code> without any options starts the Play console. The <code>console</code> command can then start a Scala console which provides access to the Play application.</p>
<h1 id="configuration">Configuration</h1>
<p>The <code class="path">conf​/application​.conf</code> file is the master configuration file in Play. From there all aspects of Play and other third-party libraries like Akka can be configured. The configuration format is based on the <a href="https://github.com/typesafehub/config">config</a> library which supports a superset of <abbr title="JavaScript Object Notation">JSON</abbr>, Java Properties, comments, file includes, file merging, units (e.g. days, MB, etc.), and so on.</p>
<p>Environment variables are often used for operating system-independent, machine-specific configuration. The <code>${}</code> syntax is used to interpolate environment variables and other properties as well. These can be interpolated into other values.</p>
<figure class="codeblock"><pre><code class="highlight language-text">db.default.url = ${DATABASE_URL}

log.directory = /var/log
log.access = ${log.directory}/access.log
log.error  = ${log.directory}/error.log</code></pre></figure>
<p>It’s also possible to include other files, which allows to create context-specific configuration files that are then included into the larger configuration file. Objects can be merged together as well based on the order in which they appear.</p>
<figure class="codeblock"><figcaption><span>db.conf</span></figcaption><pre><code class="highlight language-text">db: {
  default: {
    driver: &quot;org.h2.Driver&quot;,
    url: &quot;jdbc:h2:mem:play&quot;,
    user: &quot;sa&quot;,
    password: &quot;&quot;,
  }
}</code></pre></figure>
<figure class="codeblock"><figcaption><span>application.conf</span></figcaption><pre><code class="highlight language-text">include &quot;db.conf&quot;

db.default.user = products
db.default.password = clippy</code></pre></figure>
<p>There’s also a configuration API for type-safe access to configuration properties. Currently the supported types are <code>String</code>, <code>Int</code>, and <code>Boolean</code>, where <code>Boolean</code> can take on <code>true</code>, <code>yes</code>, and <code>enabled</code> (and their opposites).</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">import</span> <span class="nn">play.api.Play.current</span>

<span class="n">current</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">&quot;db.default.url&quot;</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
  <span class="n">databaseUrl</span> <span class="k">=&gt;</span> <span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="n">databaseUrl</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></figure>
<p>Since the configuration is structured hierarchically, it’s possible to get sub-configuration values for a given level:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="n">current</span><span class="o">.</span><span class="n">configuration</span><span class="o">.</span><span class="n">getConfig</span><span class="o">(</span><span class="s">&quot;db.default&quot;</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
  <span class="n">dbConfig</span> <span class="k">=&gt;</span>
  <span class="n">dbConfig</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">&quot;driver&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
  <span class="n">dbConfig</span><span class="o">.</span><span class="n">getString</span><span class="o">(</span><span class="s">&quot;url&quot;</span><span class="o">).</span><span class="n">map</span><span class="o">(</span><span class="nc">Logger</span><span class="o">.</span><span class="n">info</span><span class="o">(</span><span class="k">_</span><span class="o">))</span>
<span class="o">}</span>
</code></pre></figure>
<h2 id="routing">Routing</h2>
<p>The <code class="path">conf​/routes</code> file contains the mapping of routes to controller actions.</p>
<figure class="codeblock"><pre><code class="highlight language-text">GET /         controllers.Products.home()

# if parameter not passed, assume to be 1
GET /products controllers.Products.list(page: Int ?= 1)

# parameter is optional; may or may not appear
GET /apples   controllers.Apples.show(page: Option[Int])

# parameter is fixed to 1
GET /oranges  controllers.Oranges.show(page: Int = 1)

# route variable
GET /product/:ean controllers.Products.details(ean: Long)

# path parameter
GET /photo/*filepath controllers.Media.photo(file: String)

# path parameter with different external prefix
GET /assets/*filepath controllers.Assets.at(path=&quot;/public&quot;, file)

GET /product/$ean&lt;\d{13}&gt; controllers.Products.details(ean: Long)</code></pre></figure>
<p>Reverse routing is a means of programmatically generating routes for a given action method invocation.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">delete</span><span class="o">(</span><span class="n">ean</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
  <span class="nc">Product</span><span class="o">.</span><span class="n">delete</span><span class="o">(</span><span class="n">ean</span><span class="o">)</span>
  <span class="c1">// or url with routes.Products.list().url</span>
  <span class="nc">Redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="nc">Products</span><span class="o">.</span><span class="n">list</span><span class="o">())</span>
<span class="o">}</span>
</code></pre></figure>
<h1 id="models">Models</h1>
<p>A model tends to consist of a model class (definition and attributes), data access object (to access model data), and some test data. The model is typically defined as a case class and its data access object is represented by a companion object.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">package</span> <span class="nn">models</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">Product</span><span class="o">(</span>
  <span class="n">ean</span><span class="k">:</span> <span class="kt">Long</span><span class="o">,</span> <span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>

<span class="k">object</span> <span class="nc">Product</span> <span class="o">{</span>
  <span class="k">var</span> <span class="n">products</span> <span class="k">=</span> <span class="nc">Set</span><span class="o">(</span>
    <span class="nc">Product</span><span class="o">(</span><span class="mi">1L</span><span class="o">,</span> <span class="s">&quot;House&quot;</span><span class="o">,</span> <span class="s">&quot;A huge house&quot;</span><span class="o">),</span>
    <span class="nc">Product</span><span class="o">(</span><span class="mi">2L</span><span class="o">,</span> <span class="s">&quot;Boat&quot;</span><span class="o">,</span> <span class="s">&quot;A tug boat&quot;</span><span class="o">),</span>
    <span class="nc">Product</span><span class="o">(</span><span class="mi">3L</span><span class="o">,</span> <span class="s">&quot;Car&quot;</span><span class="o">,</span> <span class="s">&quot;A luxurious car&quot;</span><span class="o">)</span>
  <span class="o">)</span>

  <span class="k">def</span> <span class="n">findAll</span> <span class="k">=</span> <span class="n">products</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">sortBy</span><span class="o">(</span><span class="k">_</span><span class="o">.</span><span class="n">ean</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></figure>
<h2 id="persistence">Persistence</h2>
<p>Play allows for <em>evolutions</em> which are similar to Rails database migrations, which are stored in <code class="path">conf​/evolutions​/default​/</code> and are named <code>#.sql</code> where <code>#</code> is the revision number. Play automatically asks to apply the evolution the next time the application is accessed. Evolutions take the following form:</p>
<figure class="codeblock"><pre><code class="highlight language-sql"><span class="o">#</span> <span class="c1">--- !Ups</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">products</span> <span class="p">(</span><span class="n">id</span> <span class="n">long</span><span class="p">,</span> <span class="n">ean</span> <span class="n">long</span><span class="p">);</span>

<span class="o">#</span> <span class="c1">--- !Downs</span>

<span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">IF</span> <span class="k">EXISTS</span> <span class="n">products</span><span class="p">;</span>
</code></pre></figure>
<p>Play comes with Squeryl, a DSL for generating SQL in a type-safe manner, and Anorm, which allows raw SQL queries to be written explicitly.</p>
<div class="callout">
<p><strong>Note</strong>: Recent versions of Play allow the use of <a href="http://slick.typesafe.com/">Slick</a>, which is the preferred method of interfacing with databases going forward.</p>
</div>
<p>Anorm has three ways of processing results: Stream API, pattern matching, and parser combinators. SQL queries are constructed using the <code>SQL</code> class. The <code>apply</code> method of <code>SQL</code> accepts an implicit parameter of type <code>java.sql.Connection</code>, which <code>Play</code> provides from <code>DB.withConnection</code>. This <code>apply</code> method returns a <code>Stream[SqlRow]</code> which can be <code>map</code>ped over.</p>
<p>The SQL query contains <code>SqlRow</code> objects which have an <code>apply</code> method that retrieves the field by name. An explicit type parameter is provided to ensure that the field gets cast to the correct Scala type.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">import</span> <span class="nn">play.api.Play.current</span>
<span class="k">import</span> <span class="nn">play.api.db.DB</span>

<span class="k">import</span> <span class="nn">anorm.SQL</span>
<span class="k">import</span> <span class="nn">anorm.SqlQuery</span>

<span class="k">object</span> <span class="nc">Product</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">getAll</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Product</span><span class="o">]</span> <span class="k">=</span> <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">sql</span><span class="k">:</span> <span class="kt">SqlQuery</span> <span class="o">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;select * from products order by name asc&quot;</span><span class="o">)</span>

    <span class="n">sql</span><span class="o">().</span><span class="n">map</span> <span class="o">(</span> <span class="n">row</span> <span class="k">=&gt;</span>
      <span class="nc">Product</span><span class="o">(</span><span class="n">row</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="s">&quot;id&quot;</span><span class="o">),</span> <span class="n">row</span><span class="o">[</span><span class="kt">Long</span><span class="o">](</span><span class="s">&quot;ean&quot;</span><span class="o">),</span>
              <span class="n">row</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;name&quot;</span><span class="o">),</span> <span class="n">row</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&quot;description&quot;</span><span class="o">))</span>
    <span class="o">).</span><span class="n">toList</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></figure>
<p>The above transformation can also be applied with pattern matching.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">getAll</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Product</span><span class="o">]</span> <span class="k">=</span> <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
  <span class="k">import</span> <span class="nn">anorm.Row</span>

  <span class="k">val</span> <span class="n">sql</span><span class="k">:</span> <span class="kt">SqlQuery</span> <span class="o">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;select * from products order by name asc&quot;</span><span class="o">)</span>

  <span class="n">sql</span><span class="o">().</span><span class="n">collect</span> <span class="o">{</span>
    <span class="k">case</span> <span class="nc">Row</span><span class="o">(</span><span class="nc">Some</span><span class="o">(</span><span class="n">id</span><span class="k">:</span> <span class="kt">Long</span><span class="o">),</span> <span class="nc">Some</span><span class="o">(</span><span class="n">ean</span><span class="k">:</span> <span class="kt">Long</span><span class="o">),</span>
             <span class="nc">Some</span><span class="o">(</span><span class="n">name</span><span class="k">:</span> <span class="kt">String</span><span class="o">),</span> <span class="nc">Some</span><span class="o">(</span><span class="n">description</span><span class="k">:</span> <span class="kt">String</span><span class="o">))</span> <span class="k">=&gt;</span>
         <span class="nc">Product</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">ean</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">description</span><span class="o">)</span>
  <span class="o">}.</span><span class="n">toList</span>
<span class="o">}</span>
</code></pre></figure>
<p>Finally, the query can also be transformed with parser combinators.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">import</span> <span class="nn">anorm.RowParser</span>

<span class="k">val</span> <span class="n">productParser</span><span class="k">:</span> <span class="kt">RowParser</span><span class="o">[</span><span class="kt">Product</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">anorm.</span><span class="o">~</span>
  <span class="k">import</span> <span class="nn">anorm.SqlParser._</span>

  <span class="n">long</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="o">~</span>
  <span class="n">long</span><span class="o">(</span><span class="s">&quot;ean&quot;</span><span class="o">)</span> <span class="o">~</span>
  <span class="n">str</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="o">~</span>
  <span class="n">str</span><span class="o">(</span><span class="s">&quot;description&quot;</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">id</span> <span class="o">~</span> <span class="n">ean</span> <span class="o">~</span> <span class="n">name</span> <span class="o">~</span> <span class="n">description</span> <span class="k">=&gt;</span>
      <span class="nc">Product</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">ean</span><span class="o">,</span> <span class="n">name</span><span class="o">,</span> <span class="n">description</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></figure>
<p>This creates a <code>RowParser</code> but Anorm expects a <code>ResultSetParser</code>. The <code>*</code> means to try to match zero or more rows.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">import</span> <span class="nn">anorm.ResultSetParser</span>

<span class="k">val</span> <span class="n">productsParser</span><span class="k">:</span> <span class="kt">ResultSetParser</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">Product</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="n">productParser</span> <span class="o">*</span>
<span class="o">}</span>
</code></pre></figure>
<p>The <code>ResultSetParser</code> can then be passed to the query with the <code>as</code> method:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">getAllWithParser</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">Product</span><span class="o">]</span> <span class="k">=</span> <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span>
  <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>

  <span class="n">sql</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="n">productsParser</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></figure>
<p>A multirecord parser can be written to construct instances of objects that themselves contain other class instances from a different table. We start out by writing a <code>StockItem</code> parser.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">val</span> <span class="n">stockItemParser</span><span class="k">:</span> <span class="kt">RowParser</span><span class="o">[</span><span class="kt">StockItem</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">anorm.SqlParser._</span>
  <span class="k">import</span> <span class="nn">anorm.</span><span class="o">~</span>

  <span class="n">long</span><span class="o">(</span><span class="s">&quot;id&quot;</span><span class="o">)</span> <span class="o">~</span> <span class="n">long</span><span class="o">(</span><span class="s">&quot;product_id&quot;</span><span class="o">)</span> <span class="o">~</span>
  <span class="n">long</span><span class="o">(</span><span class="s">&quot;warehouse_id&quot;</span><span class="o">)</span> <span class="o">~</span> <span class="n">long</span><span class="o">(</span><span class="s">&quot;quantity&quot;</span><span class="o">)</span> <span class="n">map</span> <span class="o">{</span>
    <span class="k">case</span> <span class="n">id</span> <span class="o">~</span> <span class="n">productId</span> <span class="o">~</span> <span class="n">warehouseId</span> <span class="o">~</span> <span class="n">quantity</span> <span class="k">=&gt;</span>
      <span class="nc">StockItem</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">productId</span><span class="o">,</span> <span class="n">warehouseId</span><span class="o">,</span> <span class="n">quantity</span><span class="o">)</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></figure>
<p>Now a parser is needed which can parse the combination of product and stock item. The SQL join query will return a list of single arrays containing the joined parts, <code>[Product, StockItem]</code>. The <code>flatten</code> method transforms each of the single arrays into a two element tuple.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">productStockItemParser</span><span class="k">:</span> <span class="kt">RowParser</span><span class="o">[(</span><span class="kt">Product</span>, <span class="kt">StockItem</span><span class="o">)]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">import</span> <span class="nn">anorm.SqlParser._</span>
  <span class="k">import</span> <span class="nn">anorm.</span><span class="o">~</span>

  <span class="n">productParser</span> <span class="o">~</span> <span class="nc">StockItem</span><span class="o">.</span><span class="n">stockItemParser</span> <span class="n">map</span> <span class="o">(</span><span class="n">flatten</span><span class="o">)</span>
<span class="o">}</span>
</code></pre></figure>
<p>Finally we can construct the method that will retrieve each of the values and transform them into a map keyed by the <code>Product</code> and containing <code>StockItem</code> values. This transformation is possible by using the <code>groupBy</code> function to group the results by the first tuple element, the <code>Product</code>. This still leaves the values containing <code>Product</code>, specifically a <code>Map[Product,List[(Product,StockItem)]]</code>, which can be removed by using <code>mapValues</code> and mapping the tuples to replace themselves with the second tuple element, the <code>StockItem</code> values, leaving a <code>Map[Product,List[StockItem]]</code>.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">getAllProductsWithStockItems</span><span class="k">:</span> <span class="kt">Map</span><span class="o">[</span><span class="kt">Product</span>, <span class="kt">List</span><span class="o">[</span><span class="kt">StockItem</span><span class="o">]]</span> <span class="k">=</span> <span class="o">{</span>
  <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">sql</span> <span class="k">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;select p.*, s.*&quot;</span> <span class="o">+</span>
                  <span class="s">&quot;from products p&quot;</span> <span class="o">+</span>
                  <span class="s">&quot;inner join stock_items s on (p.id = s.product_id)&quot;</span><span class="o">)</span>

    <span class="k">val</span> <span class="n">results</span><span class="k">:</span> <span class="kt">List</span><span class="o">[(</span><span class="kt">Product</span>, <span class="kt">StockItem</span><span class="o">)]</span> <span class="k">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="n">productStockItemParser</span> <span class="o">*)</span>

    <span class="n">results</span><span class="o">.</span><span class="n">groupBy</span> <span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">_1</span> <span class="o">}.</span><span class="n">mapValues</span> <span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="k">_</span><span class="o">.</span><span class="n">_2</span> <span class="o">}</span> <span class="o">}</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></figure>
<p>It’s also possible to insert, update, and delete with Anorm. This is generally accomplished by preparing statements and calling <code>executeUpdate</code> on them.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">insert</span><span class="o">(</span><span class="n">product</span><span class="k">:</span> <span class="kt">Product</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
  <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">addedRows</span> <span class="k">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    insert into products</span>
<span class="s">    values ({id}, {ean}, {name}, {description})</span>
<span class="s">    &quot;&quot;&quot;</span><span class="o">).</span><span class="n">on</span><span class="o">(</span>
      <span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span><span class="o">,</span>
      <span class="s">&quot;ean&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">ean</span><span class="o">,</span>
      <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="o">,</span>
      <span class="s">&quot;description&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">description</span>
    <span class="o">).</span><span class="n">executeUpdate</span><span class="o">()</span>

    <span class="n">addedRows</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="o">}</span>

<span class="k">def</span> <span class="n">update</span><span class="o">(</span><span class="n">product</span><span class="k">:</span> <span class="kt">Product</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
  <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">updatedRows</span> <span class="k">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;&quot;&quot;</span>
<span class="s">    update products</span>
<span class="s">    set name = {name},</span>
<span class="s">        ean = {ean},</span>
<span class="s">        description = {description},</span>
<span class="s">    where id = {id}</span>
<span class="s">    &quot;&quot;&quot;</span><span class="o">).</span><span class="n">on</span><span class="o">(</span>
      <span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span><span class="o">,</span>
      <span class="s">&quot;name&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">name</span><span class="o">,</span>
      <span class="s">&quot;ean&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">ean</span><span class="o">,</span>
      <span class="s">&quot;description&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">description</span>
    <span class="o">).</span><span class="n">executeUpdate</span><span class="o">()</span>

    <span class="n">updateRows</span> <span class="o">==</span> <span class="mi">1</span>
  <span class="o">}</span>

<span class="k">def</span> <span class="n">delete</span><span class="o">(</span><span class="n">product</span><span class="k">:</span> <span class="kt">Product</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span>
  <span class="nc">DB</span><span class="o">.</span><span class="n">withConnection</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">connection</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">updatedRows</span> <span class="k">=</span> <span class="nc">SQL</span><span class="o">(</span><span class="s">&quot;delete from products where id = {id}&quot;</span><span class="o">).</span>
      <span class="n">on</span><span class="o">(</span><span class="s">&quot;id&quot;</span> <span class="o">-&gt;</span> <span class="n">product</span><span class="o">.</span><span class="n">id</span><span class="o">).</span>
      <span class="n">executeUpdate</span><span class="o">()</span>

    <span class="n">updatedRows</span> <span class="o">==</span> <span class="mi">0</span>
  <span class="o">}</span>
</code></pre></figure>
<h1 id="views">Views</h1>
<p>Templates in Play are type-safe and consist of interspersed Scala, avoiding the need to learn a template DSL. Templates can specify a parameter list as the first line, which can be used to provide data from the controller’s end.</p>
<p>The <code>@</code> character is used to denote the start of a Scala expression, where the parser <em>conservatively</em> determines the extent of the expression. Sometimes it may be necessary to explicitly define this range, which is possible by using parentheses. If it’s necessary to print a <code>@</code> character verbatim, it must be escaped by another <code>@</code>. Comments are delimited with <code>@* *@</code>.</p>
<figure class="codeblock"><pre><code class="highlight language-text">Hello @name!

@* output the year *@

Next year, your age will be @(user.age + 1)</code></pre></figure>
<p>The template parser encloses all template expressions in curly braces, so it’s not possible to define a variable in one expression and use it in another in the same level. More specifically, the bodies of functions, for comprehensions, and so on are treated as “sub-templates,” so the body isn’t treated as XML literals in the case of HTML templates.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="o">@{</span><span class="k">var</span> <span class="n">i</span> <span class="k">=</span> <span class="mi">0</span><span class="o">}</span>
<span class="nd">@articles</span><span class="o">.</span><span class="n">map</span> <span class="o">{</span> <span class="n">article</span> <span class="k">=&gt;</span>
  <span class="o">@{</span><span class="n">i</span> <span class="k">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="o">}</span> <span class="c1">// yields not found: value i</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;@</span><span class="n">i</span> <span class="o">-</span> <span class="nd">@article</span><span class="o">.</span><span class="n">name</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">}</span>

<span class="nd">@for</span><span class="o">((</span><span class="n">article</span><span class="o">,</span> <span class="n">index</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">articles</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">)</span> <span class="o">{</span>
  <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;@(</span><span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">)</span> <span class="o">-</span> <span class="nd">@article</span><span class="o">.</span><span class="n">name</span><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
<span class="o">}</span>
</code></pre></figure>
<p>It’s possible to clean up a lot of value declarations by defining them inside the for comprehension:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="nd">@for</span><span class="o">((</span><span class="n">article</span><span class="o">,</span> <span class="n">index</span><span class="o">)</span> <span class="k">&lt;-</span> <span class="n">articles</span><span class="o">.</span><span class="n">zipWithIndex</span><span class="o">;</span>
     <span class="n">rank</span> <span class="k">=</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
     <span class="n">first</span> <span class="k">=</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="o">;</span>
     <span class="n">last</span> <span class="k">=</span> <span class="n">index</span> <span class="o">==</span> <span class="n">articles</span><span class="o">.</span><span class="n">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">)</span> <span class="o">{</span>
  <span class="c1">// use values here</span>
<span class="o">}</span>
</code></pre></figure>
<p>It’s also possible to define a scope with an associated value, to avoid having to re-evaluate that expression each time.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="nd">@defining</span><span class="o">(</span><span class="n">article</span><span class="o">.</span><span class="n">countReview</span><span class="o">())</span> <span class="o">{</span> <span class="n">total</span> <span class="k">=&gt;</span>
  <span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;@</span><span class="n">total</span> <span class="nd">@total</span> <span class="nd">@total</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">}</span>
</code></pre></figure>
<h2 id="escaping">Escaping</h2>
<p>All Scala expressions’ output is escaped. Values can be output unescaped by wrapping them in the <code>Html</code> type.</p>
<h2 id="includes">Includes</h2>
<p>There is no distinction between partials, known as <em>includes</em> in Play, and regular templates. Any template can be embedded within another by simply calling the generated object’s apply method in a Scala expression.</p>
<figure class="codeblock"><figcaption><span>partial.scala.html</span></figcaption><pre><code class="highlight language-html">@()
<span class="nt">&lt;strong&gt;</span>This is a partial<span class="nt">&lt;/strong&gt;</span>
</code></pre></figure>
<figure class="codeblock"><figcaption><span>index.scala.html</span></figcaption><pre><code class="highlight language-html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;announcement&quot;</span><span class="nt">&gt;</span>
  @navigation()
<span class="nt">&lt;/div&gt;</span>
</code></pre></figure>
<h2 id="layouts">Layouts</h2>
<p>A layout can be created in a straightforward manner from the template concepts covered so far. First it’s necessary to add a parameter of type <code>Html</code> to the layout template. Other templates that want to embed themselves in a layout simply call the layout template and use the braces <code>{}</code> method call syntax to pass the entire template to the layout.</p>
<figure class="codeblock"><figcaption><span>main.scala.html</span></figcaption><pre><code class="highlight language-html">@(title=&quot;Default Title&quot;)(content: Html)
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;title&gt;</span>@title<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
  @content
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></figure>
<figure class="codeblock"><figcaption><span>products.scala.html</span></figcaption><pre><code class="highlight language-html">@main(&quot;Products&quot;) {
  <span class="nt">&lt;strong&gt;</span>Some Products<span class="nt">&lt;/strong&gt;</span>
}
</code></pre></figure>
<p>It’s possible to define implicit parameters on template parameter lists to avoid having to explicitly pass parameters to the templates. A common pattern is to define a reusable trait with the appropriate implicit values. The <code>WrappedRequest</code> class wraps a <code>Request</code> and can be extended by a class that defines other values that should be accessible by a template.</p>
<h2 id="localization">Localization</h2>
<p>Localization is pretty straightforward in Play. The <code class="path">application​.conf</code> file can take an <code class="path">application​.langs</code> option that defines a comma-separated list of languages in ISO 639-2 format optionally followed by an ISO 3166-1 alpha-2 country code.</p>
<figure class="codeblock"><pre><code class="highlight language-text">application.langs=&quot;en,en-US,nl&quot;</code></pre></figure>
<p>For each of these languages there should be a corresponding <code class="path">conf​/messages​.lang</code> file which defines localized messages. These messages can then be referenced using the <code>Messages</code> object which takes the message’s key as well as an implicit <code>Lang</code> value which can be implicitly converted from a <code>Request</code> in the scope.</p>
<p>Messages in the file are patterns formatted using <a href="http://docs.oracle.com/javase/8/docs/api/java/text/MessageFormat.html"><code class="path">java​.text​.MessageFormat</code></a>, so that arguments can be inserted with <code>{#}</code> where the <code>#</code> is the position of the argument. It’s also possible to define different messages for zero, one, more items:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="c1">// cart=Cart {0,choice,0#is empty|1#has one item|1&lt; has {0} items}.</span>

<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;@</span><span class="nc">Messages</span><span class="o">(</span><span class="s">&quot;cart&quot;</span><span class="o">,</span> <span class="mi">0</span><span class="o">)&lt;/</span><span class="n">p</span><span class="o">&gt;</span> <span class="c1">// is empty</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;@</span><span class="nc">Messages</span><span class="o">(</span><span class="s">&quot;cart&quot;</span><span class="o">,</span> <span class="mi">1</span><span class="o">)&lt;/</span><span class="n">p</span><span class="o">&gt;</span> <span class="c1">// has one item</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;@</span><span class="nc">Messages</span><span class="o">(</span><span class="s">&quot;cart&quot;</span><span class="o">,</span> <span class="mi">2</span><span class="o">)&lt;/</span><span class="n">p</span><span class="o">&gt;</span> <span class="c1">// has 2 items</span>
</code></pre></figure>
<h1 id="controllers">Controllers</h1>
<p>Controllers derive from <code>Controller</code> and are basically generators of actions by defining methods that return an instance of <code>Action</code>, which constructs a function that handles a request and returns a result. More specifically, this function is of type <code>Request[A] =&gt; Result</code> where <code>A</code> is the type of the request body.</p>
<p>They generally mark the <code>request</code> object as <code>implicit</code> so that it may be passed to functions implicitly.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">package</span> <span class="nn">controllers</span>

<span class="k">import</span> <span class="nn">play.api.mvc.</span><span class="o">{</span><span class="nc">Action</span><span class="o">,</span> <span class="nc">Controller</span><span class="o">}</span>
<span class="k">import</span> <span class="nn">models.Product</span>

<span class="k">object</span> <span class="nc">Products</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="o">{</span>
  <span class="k">def</span> <span class="n">list</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span> <span class="k">implicit</span> <span class="n">request</span> <span class="k">=&gt;</span>
    <span class="k">val</span> <span class="n">products</span> <span class="k">=</span> <span class="nc">Product</span><span class="o">.</span><span class="n">findAll</span>
    <span class="nc">Ok</span><span class="o">(</span><span class="n">views</span><span class="o">.</span><span class="n">html</span><span class="o">.</span><span class="n">products</span><span class="o">.</span><span class="n">list</span><span class="o">(</span><span class="n">products</span><span class="o">))</span>
  <span class="o">}</span>

  <span class="k">def</span> <span class="n">details</span><span class="o">(</span><span class="n">ean</span><span class="k">:</span> <span class="kt">Long</span><span class="o">)</span> <span class="k">=</span> <span class="nc">Action</span> <span class="o">{</span>
    <span class="nc">NotImplemented</span> <span class="c1">// HTTP 501</span>
  <span class="o">}</span>
<span class="o">}</span>
</code></pre></figure>
<p>The <code>as</code> method allows setting the mime-type in a convenient manner, and the <code>withHeaders</code> method allows setting headers.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="nc">Ok</span><span class="o">(</span><span class="s">&quot;some result&quot;</span><span class="o">)</span>
  <span class="o">.</span><span class="n">as</span><span class="o">(</span><span class="nc">JSON</span><span class="o">)</span>
  <span class="o">.</span><span class="n">withHeaders</span><span class="o">(</span><span class="nc">LOCATION</span> <span class="o">-&gt;</span> <span class="n">url</span><span class="o">)</span>
</code></pre></figure>
<p>Actions can be composed, facilitating the re-use of common handlers such as authentication checking and caching:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="k">def</span> <span class="n">list</span> <span class="k">=</span>
  <span class="nc">Authenticate</span> <span class="o">{</span>
    <span class="nc">Cached</span> <span class="o">{</span>
      <span class="nc">Action</span> <span class="o">{</span>
        <span class="c1">// process request</span>
      <span class="o">}</span>
    <span class="o">}</span>
  <span class="o">}</span>
</code></pre></figure>
<h2 id="session">Session</h2>
<p>The session is represented as a map <code>Map[String, String]</code> in <code>request.session</code> and can easily be modified with the <code>withSession</code> method.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="nc">Ok</span><span class="o">(</span><span class="n">result</span><span class="o">).</span><span class="n">withSession</span><span class="o">(</span>
  <span class="n">request</span><span class="o">.</span><span class="n">session</span> <span class="o">+</span> <span class="o">(</span><span class="s">&quot;some.data&quot;</span> <span class="o">-&gt;</span> <span class="n">value</span><span class="o">)</span>
<span class="o">)</span>

<span class="c1">// later on</span>

<span class="k">val</span> <span class="n">data</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="o">(</span><span class="s">&quot;some.data&quot;</span><span class="o">)</span>
</code></pre></figure>
<p>A flash scope is available as in most other web frameworks which is essentially stored in the session and the values only live on until the next request. The <code>flashing</code> method makes this straightforward:</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="nc">Redirect</span><span class="o">(</span><span class="n">routes</span><span class="o">.</span><span class="nc">Products</span><span class="o">.</span><span class="n">list</span><span class="o">()).</span><span class="n">flashing</span><span class="o">(</span><span class="s">&quot;info&quot;</span> <span class="o">-&gt;</span> <span class="s">&quot;Product deleted!&quot;</span><span class="o">)</span>

<span class="c1">// later on</span>

<span class="k">val</span> <span class="n">message</span> <span class="k">=</span> <span class="n">request</span><span class="o">.</span><span class="n">flash</span><span class="o">(</span><span class="s">&quot;info&quot;</span><span class="o">)</span>
</code></pre></figure>
<h2 id="assets">Assets</h2>
<p>The assets controller allows for reverse routing to asset files.</p>
<figure class="codeblock"><pre><code class="highlight language-scala"><span class="o">&lt;</span><span class="n">link</span> <span class="n">href</span><span class="o">=</span><span class="s">&quot;@routes.Assets.at(&quot;</span><span class="n">images</span><span class="o">/</span><span class="n">favicon</span><span class="o">.</span><span class="n">png</span><span class="s">&quot;)&quot;</span> <span class="n">type</span><span class="o">=</span><span class="s">&quot;image/png&quot;</span><span class="o">&gt;</span>
</code></pre></figure>
<p>The assets controller handles this automatically by adding an <code>Etag</code> header. HTTP Entity Tags (ETags) allows a client to make a conditional HTTP request for a resource so that the server can tell it whether or not to use the cached copy instead.</p>
<p>Compression is also automatically enabled if:</p>
<ul>
<li>in production mode</li>
<li>request is routed to assets controller</li>
<li>HTTP request has <code>Accept-Encoding: gzip</code></li>
<li>file with same name and <code>.gz</code> suffix is found</li>
</ul>
<p>Play has built-in support for Less and CoffeeScript. Such files can easily be referenced using the assets reverse router by its target extension. The extension can be prefixed by <code>min</code> to use a minified version. A file can opt-out of compilation by prefixing its name with an underscore.</p></div>
  <div class="meta">
    <div class="meta-component"><i class="fa fa-calendar fa-fw"></i> April  7, 2014</div>
    <div class="meta-component"><i class="fa fa-code-fork fa-fw"></i> <a href="https://github.com/blaenk/blaenk.github.io/commits/source/provider/notes/play.markdown">History</a><span class="hash">, <a href="https://github.com/blaenk/blaenk.github.io/commit/ff51eed" title="finished templates">ff51eed</a></span></div>
    <div class="meta-component"><i class="fa fa-pencil fa-fw"></i> <a href="..">Notes</a></div>
  </div>
</article>


    </div>
    <footer id="footer" class="inner">
      <div id="social">
        <a href="https://github.com/blaenk" title="github"><i class="fa fa-github-alt"></i></a>
        &middot;
        <a href="http://stackoverflow.com/users/101090/jorge-israel-pena" title="stackoverflow"><i class="fa fa-stack-overflow"></i></a>
        &middot;
        <a href="https://twitter.com/blaenk" title="twitter"><i class="fa fa-twitter"></i></a>
        &middot;
        <a href="mailto:jorge.israel.p@gmail.com" title="email"><i class="fa fa-envelope"></i></a>
        &middot;
        <a href="/atom.xml" title="feed"><i class="fa fa-rss-square"></i></a>
      </div>
    </footer>
    
    
    <!-- google analytics -->
    <script async="true" type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-37339861-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
    <!--MathJax CDN-->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        messageStyle: "none"
      });

      MathJax.Hub.Register.MessageHook('End Process', function() {
        jQuery('#MathJax_Font_Test').empty();
        jQuery('.MathJax_Display').parent('.math').addClass('mobile-math');
      });
    </script>
    <script async="true" type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
    </script>
  </div>
</body>
</html>
