<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>GDB - Blaenk Denum</title>
  <meta name="author" content="Jorge Israel Peña">
  <meta name="description" content="AKA Blaenk Denum">

  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link href="/favicon.png" rel="shortcut icon">
  <link href='http://fonts.googleapis.com/css?family=Noto+Sans:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Merriweather:900italic,900,700italic,400italic,700,400,300italic,300' rel='stylesheet' type='text/css'>
  <link href="//netdna.bootstrapcdn.com/font-awesome/4.0.0/css/font-awesome.css" rel="stylesheet">
  <link href='/css/screen.css' rel='stylesheet' type='text/css' media='screen' />
  <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/atom.xml" />
  <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
  <script src='/js/blaenk.js' type='text/javascript'></script>
</head>
<body>
  <div id="strip"></div>
  <header id="header" class="inner">
    <div id="stamp">
      <h1><a href="/">Jorge Israel Peña</a></h1>
      <h4>AKA BLAENK DENUM</h4>
    </div>
    <nav id="main-nav">
      <ul class="main">
        <li><a href="/about/">About</a></li>
        <li><a href="/work/">Work</a></li>
        <li><a href="/lately/">Lately</a></li>
        <li><a href="/notes/">Notes</a></li>
        <li><a id="search_btn">Search</a></li>
      </ul>
      <form class="desk_search" action="http://google.com/search" method="get">
        <input type="text" name="q" results="0" placeholder="Search... (Click 'Search' to hide)" autocomplete="off" spellcheck="false">
        <input type="hidden" name="q" value="site:blaenkdenum.com">
      </form>
    </nav>
    <nav id="mobile-nav">
      <div class="alignleft menu">
        <a class="button">Menu</a>
        <div class="container">
          <ul class="main">
            <li><a href="/about/">About</a></li>
            <li><a href="/work/">Work</a></li>
            <li><a href="/lately/">Lately</a></li>
            <li><a href="/notes/">Notes</a></li>
            <li><a id="search_btn">Search</a></li>
          </ul>
        </div>
      </div>
      <div class="alignright search">
        <a class="button"></a>
        <div class="container">
          <form action="http://google.com/search" method="get">
            <input type="text" name="q" results="0">
            <input type="hidden" name="q" value="site:blaenkdenum.com">
          </form>
        </div>
      </div>
    </nav>
  </header>
  <div id="content" class="inner">
    <article class="post">
  <h2 class="title"><a href="/notes/gdb/"><span>GDB</span></a></h2>
  <div class="entry-content"><p>It seems that using a debugger like the <a href="http://en.wikipedia.org/wiki/GNU_Debugger%20*[GDB]:%20GNU%20Debugger">GNU Debugger</a> (<abbr title="GNU Debugger">GDB</abbr>) has become something of a lost art for the generation of developers whom are more involved with higher-level languages. Instead, it seems many people resort to so-called <code>printf</code>-debugging, where one places print statements all over the place to sort of trace the state of the program’s execution at any given moment. Of course, this is very tedious, and can be done more naturally and efficiently with a dedicated debugger.</p>
<p>This notes page covers <abbr title="GNU Debugger">GDB</abbr>’s native interface in particular, although there are a couple of interfaces such as <a href="http://cgdb.github.io/">cgdb</a>, a lightweight interface with vim binds, as well as <a href="https://www.gnu.org/software/ddd/">DDD</a>, which is a more general-purpose debugging interface.</p>
<p>Aside from <abbr title="GNU Debugger">GDB</abbr> there’s also <a href="http://lldb.llvm.org/">LLDB</a> to keep an eye on, which is the LLVM project’s very own debugger. A <a href="http://lldb.llvm.org/tutorial.html">tutorial</a> is available, as well as a table listing the <a href="http://lldb.llvm.org/lldb-gdb.html">LLDB equivalents</a> for various <abbr title="GNU Debugger">GDB</abbr> commands.</p>
<p>Remember that, when debugging, it’s best if a program is built with a symbol table — the list of memory addresses corresponding to the program’s variables and lines of code — by passing the <code>-g</code> parameter to gcc or clang.</p>
<p>For an additional resource, <abbr title="Richard M. Stallman">RMS</abbr>’ own <a href="http://www.unknownroad.com/rtfm/gdbtut/">tutorial</a> on <abbr title="GNU Debugger">GDB</abbr> is available, as well as this <a href="http://rsquared.sdf.org/gdb/">very good guide</a>.</p>
<nav id="toc"><p>Contents</p><ol><li><a href="#workflow">Workflow</a><ol><li><a href="#session">Session</a></li></ol></li><li><a href="#breakpoints">Breakpoints</a><ol><li><a href="#deleting">Deleting</a></li><li><a href="#disabling">Disabling</a></li><li><a href="#conditionals">Conditionals</a></li><li><a href="#command-lists">Command Lists</a></li><li><a href="#watchpoints">Watchpoints</a></li><li><a href="#signals">Signals</a></li><li><a href="#information">Information</a></li></ol></li><li><a href="#executing">Executing</a><ol><li><a href="#stepping">Stepping</a></li><li><a href="#resuming">Resuming</a></li></ol></li><li><a href="#inspecting">Inspecting</a><ol><li><a href="#source">Source</a></li><li><a href="#printing">Printing</a></li><li><a href="#call-stack-navigation">Call Stack Navigation</a></li><li><a href="#setting">Setting</a></li></ol></li><li><a href="#core-files">Core Files</a></li><li><a href="#threads">Threads</a></li><li><a href="#abbreviations">Abbreviations</a></li></ol></nav>
<h1 id="workflow">Workflow</h1>
<p><abbr title="GNU Debugger">GDB</abbr> is usually started by passing it the name of the program we want to debug:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span>gdb program_to_debug
</code></pre></figure>
<p>Processes with curses-like interfaces can be debugged by running them in a separate terminal and then attaching to them with the <code>-p</code> switch (or using the <code>attach</code> command):</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span>gdb -p PID
<span class="c"># or</span>
<span class="nv">$ </span>gdb programname PID
</code></pre></figure>
<p>Another thing that can be done is to run <abbr title="GNU Debugger">GDB</abbr> and tell it that the program should be run on a different terminal. This is accomplished with the <code>tty</code> command. For example, assuming the program should be on <code>/dev/pts/8</code> — perhaps because we have another window paired with that pseudoterminal — we would run the following:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) tty /dev/pts/8</code></pre></figure>
<p>Then the following should be entered so that the keyboard input to the window will go to the program rather than to the shell, by making the shell go to sleep:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span>sleep 100000
</code></pre></figure>
<p>Entering nothing at this prompt re-runs the previous command, which is very useful when stepping with <code>next</code>.</p>
<p>It’s common to then place a temporary breakpoint on <code>main</code> as an entrypoint into the debugging session with <code>tbreak main</code>.</p>
<p>The program is then run with the <code>run</code> command, passing it the appropriate program arguments. The program’s execution will be paused at each breakpoint:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) run arg1 arg2
Starting program: /path/to/program_to_debug arg1 arg2

Breakpoint 1, function_containing_breakpoint(ac=4, av=0xbffff094) at src.c:16</code></pre></figure>
<p>If the program was previously run, the arguments passed to the previous <code>run</code> can be reused by simply entering <code>run</code> on its own. If the program is already running, <abbr title="GNU Debugger">GDB</abbr> will ask if it should restart the program.</p>
<p><abbr title="GNU Debugger">GDB</abbr> is focused on one file at any given moment, which is the file that will be looked for when given parameters without specifying the file name, such as breaking by line number or function name. The first focused file is the one with the <code>main</code> entry point, but the file focus is changed whenever the <code>list</code> command is run, when one steps into code residing on a different file, or when hitting a breakpoint from a separate source file.</p>
<h2 id="session">Session</h2>
<p>It’s normal to keep a <abbr title="GNU Debugger">GDB</abbr> session to open during the debugging session. As bugs are fixed and the program is recompiled, <abbr title="GNU Debugger">GDB</abbr> will detect the changes and load them in. Breakpoints and other information specified in ways not dependent on line numbers should continue to work.</p>
<p>However, if exiting is necessary, the commands entered can be saved to a <abbr title="GNU Debugger">GDB</abbr> startup file of name <code>.gdbinit</code>. This can then be loaded when <abbr title="GNU Debugger">GDB</abbr> loads with:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span>gdb -command<span class="o">=</span>.gdbinit program
</code></pre></figure>
<p>Breakpoints can be saved to a file with:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) save breakpoints filename
(gdb) source filename</code></pre></figure>
<p>History can be saved by putting this in <code>~/.gdbinit</code>:</p>
<figure class="codeblock"><pre><code class="highlight language-text">set history filename ~/.gdb_history
set history save</code></pre></figure>
<h1 id="breakpoints">Breakpoints</h1>
<p>Breakpoints, set with the <code>break</code> command, pause execution of the program just before that line of code executes.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break function
(gdb) break line
(gdb) break file:line
(gdb) break file:function</code></pre></figure>
<p>It’s also possible to set a breakpoint relative to the currently executing line of course code in the currently selected stack frame:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break +offset
(gdb) break -offset</code></pre></figure>
<p>It’s also possible to set a breakpoint at a specific virtual memory address, which is useful when there are no debugging symbols:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break *address</code></pre></figure>
<p>If breaking based on the function name, a breakpoint is applied for every function with that name, which can be troublesome in C++ which allows function overloading. It’d be necessary to disambiguate by line number or file path.</p>
<p>A temporary breakpoint, set with the <code>tbreak</code> command, is one that operates just like a regular breakpoint but it clears itself after the first time it is reached.</p>
<p>Catchpoints are similar to breakpoints and are triggered by things such as thrown and caught exceptions, signals, calls to <code>fork()</code>, loading and unloading of libraries, and other events.</p>
<h2 id="deleting">Deleting</h2>
<p>Breakpoints can be either deleted in two ways, using the <code>delete</code> or <code>clear</code> commands. The <code>delete</code> command accepts breakpoint identifiers or if none are given, deletes all breakpoints:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) delete breakpoint_list
(gdb) delete # deletes all breakpoints</code></pre></figure>
<p>The <code>clear</code> command accepts arguments similar to the <code>break</code> command. If no argument is given, it deletes the breakpoint at the next instruction that <abbr title="GNU Debugger">GDB</abbr> will execute, which is useful for deleting the breakpoint that <abbr title="GNU Debugger">GDB</abbr> just reached:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) clear # delete breakpoint that was just reached</code></pre></figure>
<h2 id="disabling">Disabling</h2>
<p>The <code>disable</code> command is like the <code>delete</code> command in its arguments, but it simply disables breakpoints instead of removing them. Like the <code>delete</code> command, if no argument is provided, it disables all breakpoints.</p>
<p>The <code>enable</code> command is the opposite of the <code>disable</code> command. The <code>enable</code> command can provide <code>tbreak</code>-like functionality with <code>enable once</code>, which enables a list of breakpoints and then disables them once they’re reached.</p>
<h2 id="conditionals">Conditionals</h2>
<p>A condition can be associated with a breakpoint, using the <code>contidion</code> command, so that execution only pauses at it if it satisfies the condition. The condition can refer to variables local to the scope of the breakpoint. For example, the following places a condition on breakpoint #1 so that it only breaks if <code>num_y</code> is <code>1</code>:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) condition 3 i == 10</code></pre></figure>
<p>This condition also could have been provided to the <code>break</code> command itself as follows:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break 3 if i == 10</code></pre></figure>
<p>A condition can be removed from an existing breakpoint as well:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) cond 3</code></pre></figure>
<p>Pretty much any valid C conditional statement can be used, where true is non-zero and false is zero. This includes equality, logical, and inequality operators, bitwise and shift operators, arithmetic operators, and functions — either from the program itself or from libraries, provided they’re linked into the program.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break 180 if string == NULL && i < 0
(gdb) break test.c:34 if (x & y) == 1
(gdb) break myfunc if i % (j + 3) != 0
(gdb) break test.c:myfunc if !check_variable_sanity(i)
(gdb) break 44 if strlen(mystring) == 0</code></pre></figure>
<p><strong>Note</strong> that when using a library function or other externally-linked function that provides no debugging symbols, the result of the function will be interpreted as an integer. This can lead to misinterpretations, such as:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) print cos(0.0)
$1 = 14368</code></pre></figure>
<p>This can be alleviated if necessary by defining a <abbr title="GNU Debugger">GDB</abbr> convenience variable with the necessary type information for the function in question:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set $p = (double (*) (double))cos
(gdb) ptype $p
type = double (*)()
(gdb) p cos(3.14159265)
$2 = 14368
(gdb) p $p(3.14159265)
$4 = -1</code></pre></figure>
<h2 id="command-lists">Command Lists</h2>
<p>It’s possible to define a list of commands to be run as soon as a particular breakpoint is triggered using the <code>commands</code> command which takes the following form. If the first command in the list is the <code>silent</code> command, it’ll suppress information about the breakpoint whenever it’s triggered.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) commands breakpoint-identifier
> ...commands...
> end</code></pre></figure>
<p>Commands can be removed from a breakpoint by redefining an empty command list.</p>
<p>It’s possible to define macros — sets of commands — with the <code>define</code> command. Its form is similar to <code>commands</code>’ but its first argument is the name of the macro. The arguments are accessible as <code>$argn</code> where <code>n</code> is anywhere from <code>0</code> to <code>9</code>. Macro arguments aren’t comma separated. Useful macros can be placed in the startup file and referenced within <abbr title="GNU Debugger">GDB</abbr>. The command <code>show user</code> can be used to list all macros.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) define print_and_go
> printf $arg0, $arg1
> continue
> end</code></pre></figure>
<p>Commands can also include if conditions.</p>
<h2 id="watchpoints">Watchpoints</h2>
<p>A <em>watchpoint</em>, set with <code>watch</code>, can be thought of as being attached to an expression, such that it gets triggered when the result of that expression changes. Setting a watchpoint on a variable causes the debugger to pause execution at the point when the memory location of that variable changes. For example, to watch the <code>z</code> variable:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) watch z</code></pre></figure>
<p>More powerful watchpoints can be established that are based on conditions related to the variable in question. For example, to watch for when <code>z</code> becomes greater than <code>28</code>:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) watch (z > 28)</code></pre></figure>
<p>Watchpoints are deleted as soon as any variable in the expression goes out of scope, requiring one to re-establish them the next time that function is called, if necessary. This can be automated by a command on a breakpoint in the relevant scope that establishes the watchpoint.</p>
<h2 id="signals">Signals</h2>
<p>It’s possible to avoid the pausing of execution or printing a warning when signals are received by having <abbr title="GNU Debugger">GDB</abbr> handle them with the <code>handle</code> command. For example, to avoid stopping and printing a warning when <code>SIGUSR</code> is received:</p>
<figure class="codeblock"><pre><code class="highlight language-text">handle SIGUSR1 nostop noprint</code></pre></figure>
<h2 id="information">Information</h2>
<p>The <code>info breakpoints</code> command can provide a summary of the various breakpoints that have been established and their properties. The breakpoint’s <em>disposition</em> refers to what will happen to it the next time it’s reached.</p>
<h1 id="executing">Executing</h1>
<p>A key thing to remember is that whatever line <abbr title="GNU Debugger">GDB</abbr> is currently at has <em>not</em> been executed yet.</p>
<h2 id="stepping">Stepping</h2>
<p>Single-stepping is possible with the <code>next</code> command, where a execution proceeds one original-source-code-line — i.e. 1 C++ line, not assembly — at a time. The <code>step</code> command is similar, but if the line is on a function call, it will enter that function’s body if there are debugging symbols available for it, whereas <code>next</code> would step over it.</p>
<p>Both <code>step</code> and <code>next</code> accept optional arguments specifying how far to step.</p>
<h2 id="resuming">Resuming</h2>
<p>Execution can be resumed until the next breakpoint with the <code>continue</code> command. It accepts an optional argument <code>n</code> telling it to ignore the next <code>n</code> breakpoints.</p>
<p>The <code>finish</code> command instructs <abbr title="GNU Debugger">GDB</abbr> to resume execution until just after the current stack frame finishes, i.e. until just after the current function call finishes. However, if there are any intervening breakpoints, <abbr title="GNU Debugger">GDB</abbr> <em>will</em> pause at them.</p>
<p>The <code>until</code> command resumes execution until <abbr title="GNU Debugger">GDB</abbr> reaches a machine instruction that has a higher memory address than the current one. Like <code>finish</code>, it pauses at intervening breakpoints. The <code>until</code> command is usually useful when used on loops. It also accepts arguments similar to <code>break</code>, which causes execution to continue until that location is reached.</p>
<h1 id="inspecting">Inspecting</h1>
<p>Inspecting the program’s state at any point in its execution is usually the primary motivation for debugging and setting breakpoints, so I consider it one of the most important parts to learn.</p>
<h2 id="source">Source</h2>
<p>Source code can be shown by using the <code>list</code> command, which itself changes the file currently in focus by <abbr title="GNU Debugger">GDB</abbr>, used for setting breakpoints and other things. When it’s first run, <code>list</code> shows the 10 source lines centered around <code>main</code>. Subsequence <code>list</code> commands show the next 10 lines, stopping when the end is reached. The reverse, showing the previous 10 lines, can be done with <code>list -</code>. If <code>list</code> is given a number, it shows 10 source lines centered on that line number. This command can also accept a range of lines to print, where one of the endpoints can optionally be omitted.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) list
(gdb) list -
(gdb) list 5
(gdb) list ,28
(gdb) list 28,
(gdb) list 21,25
(gdb) list funcname
(gdb) list file.c:12
(gdb) list file.c:funcname</code></pre></figure>
<p>The number of lines output by <abbr title="GNU Debugger">GDB</abbr> when using <code>list</code> is by default 10, but this can be changed:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set listsize 5</code></pre></figure>
<h2 id="printing">Printing</h2>
<p>Basic variables such as integers can be printed with the <code>print</code> command. More complicated types will be covered later on. It’s also possible to print out individual array elements with regular index syntax.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) print y[0]
$1 = 12</code></pre></figure>
<p>The <code>print</code> command has support for printing in a variety of different format, which is done with <code>p/fmt var</code> where <code>fmt</code> is any one of:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Format</th>
<th style="text-align: center;">Code</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">address</td>
<td style="text-align: center;">a</td>
</tr>
<tr class="even">
<td style="text-align: left;">binary</td>
<td style="text-align: center;">t</td>
</tr>
<tr class="odd">
<td style="text-align: left;">char</td>
<td style="text-align: center;">c</td>
</tr>
<tr class="even">
<td style="text-align: left;">decimal</td>
<td style="text-align: center;">d</td>
</tr>
<tr class="odd">
<td style="text-align: left;">float</td>
<td style="text-align: center;">f</td>
</tr>
<tr class="even">
<td style="text-align: left;">hex</td>
<td style="text-align: center;">x</td>
</tr>
<tr class="odd">
<td style="text-align: left;">hex (left zero padded)</td>
<td style="text-align: center;">z</td>
</tr>
<tr class="even">
<td style="text-align: left;">instruction</td>
<td style="text-align: center;">i</td>
</tr>
<tr class="odd">
<td style="text-align: left;">octal</td>
<td style="text-align: center;">o</td>
</tr>
<tr class="even">
<td style="text-align: left;">unsigned decimal</td>
<td style="text-align: center;">u</td>
</tr>
<tr class="odd">
<td style="text-align: left;">string</td>
<td style="text-align: center;">s</td>
</tr>
</tbody>
</table>
<p>There is also a <code>printf</code> function which behaves the same way as the function of the same name in C, but like <code>print</code> in <abbr title="GNU Debugger">GDB</abbr>, the parentheses are optional.</p>
<p>This makes <abbr title="GNU Debugger">GDB</abbr> much more preferable to actual <code>printf</code>-debugging which modifies the source code and is itself susceptible to bugs, or can even have unforeseen consequences.</p>
<p>Structures can be printed outright and their constituent data members will be displayed.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p *structptr
$1 = {val = 12, left = 0x8049698, right = 0x0}</code></pre></figure>
<p>All of this information on one line can become difficult to read, in which case an alternative “pretty printing” scheme may be used which uses one struct member per-line:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set print pretty
(gdb) p *structptr
$1 = {
  val = 12,
  left = 0x8049698,
  right = 0x0
}</code></pre></figure>
<p>Specific members can be printed individually by accessing the same way as one would in C/C++, both <code>-&gt;</code> and <code>.</code> can be used on pointers:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p structptr->val
(gdb) p structptr.val</code></pre></figure>
<p>The <code>display</code> command registers a variable for printing every time execution pauses. If no argument is passed, it lists all auto-displayed variables. Display directives can be disabled or enabled with the corresponding commands. To remove a display directive altogether, use the <code>undisplay</code> command:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) disable display 1
(gdb) enable display 1
(gdb) undisplay 1</code></pre></figure>
<p>The <code>call</code> command can also be used to call a particular function when a breakpoint is triggered, which can be used for printing some state out using a function defined in the program, specialized for that task.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) commands 2
> printf "current tree is"
> call printtree(root)
> end</code></pre></figure>
<p>The <code>x</code> command, for “examine,” can be used to examing memory at a given address.</p>
<p>A summary of information about the current frame can be obtained with the <code>info frame</code> command. More specifically, the <code>info args</code> command can show the values of the arguments passed to the current function, and the <code>info locals</code> command can show all of the variables local to the current stack frame.</p>
<p>The <code>ptype</code> command can be used to determine the type of a variable. When the type is a structure or a class, it can show the layout/definition.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) ptype argc
type = int</code></pre></figure>
<p>A static array can be printed regularly with the <code>print</code> command:</p>
<figure class="codeblock"><pre><code class="highlight language-c"><span class="kt">int</span> <span class="n">x</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
</code></pre></figure>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p x</code></pre></figure>
<p>It’s also possible to print sub-ranges of an array, for example 5 elements starting at element 3:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p x[3]@5</code></pre></figure>
<p>Dynamically allocated arrays have to be dereferenced and <abbr title="GNU Debugger">GDB</abbr> has to be instructed on how large they are. This takes the form <code>*ptr@size</code>.</p>
<figure class="codeblock"><pre><code class="highlight language-cpp"><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span> <span class="o">*</span><span class="p">)</span><span class="n">malloc</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
<span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span>
</code></pre></figure>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p *x@6
$1 = {0, 0, 0, 12, 0, 0}</code></pre></figure>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p (int [6]) *x
$1 = {0, 0, 0, 12, 0, 0}</code></pre></figure>
<h2 id="call-stack-navigation">Call Stack Navigation</h2>
<p>The runtime information immediately available to <abbr title="GNU Debugger">GDB</abbr> is whatever is located on the current stack frame, determined by the current function call. Consider functions <code>A</code>, <code>B</code>, and <code>C</code>, where each one calls the next. If execution is paused within <code>C</code>, you can print values local to <code>C</code>’s stack frame with typical commands like <code>print</code>. That is, if function <code>C</code> has local variable <code>j</code>, it can be printed with <code>print j</code>.</p>
<p>However, it’s also possible to traverse the call stack as it is at any given moment, in order to bring a different frame into <abbr title="GNU Debugger">GDB</abbr>’s focus and therefore inspect that frame’s state. The <code>frame</code> command allows traversal relative to the current function call’s frame, which is referred to as frame <code>0</code>. For example, to go to the grand-parent’s frame:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) frame 2</code></pre></figure>
<p><abbr title="GNU Debugger">GDB</abbr> also provides simpler commands <code>up</code> and <code>down</code> for traversing relative to the currently focused stack frame.</p>
<p>The <code>backtrace</code> command shows the entire stack.</p>
<p>The command <code>where</code> can be used to determine where one is at any given moment.</p>
<h2 id="setting">Setting</h2>
<p>It’s possible to set the value of variables mid-execution using the <code>set</code> command, which provides no output from <abbr title="GNU Debugger">GDB</abbr>. Variables can also be set using the print command, which follows the setting of the variable with printing out its new value:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set x = 12
(gdb) print x = 12</code></pre></figure>
<p>There are also variables specific to <abbr title="GNU Debugger">GDB</abbr> that can be created and used. For example, <abbr title="GNU Debugger">GDB</abbr> has a <em>value history</em> which simply assigns the result of an entered command to an increasing variable name. This is similar to Scala’s interpreter which assigns the expression result values to <code>res#</code>. These variables can be referenced in future commands. The <code>$</code> variable always refers to the previous result.</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) p tmp->left
$1 = (struct node *) 0x80496a8
(gdb) p *$
$2 = {val = 5, left = 0x0, right = 0x0}</code></pre></figure>
<p>It’s also possible to set environment variables within <abbr title="GNU Debugger">GDB</abbr>:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set environment ENVVAR = 3</code></pre></figure>
<p>Convenience variables can change values according to C rules. For example, given an array <code>w</code>, its elements can be iterated in <abbr title="GNU Debugger">GDB</abbr> by creating a convenience variable that represents the iterations’ current index.</p>
<figure class="codeblock"><pre><code class="highlight language-c"><span class="kt">int</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">12</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">88</span><span class="p">};</span>
</code></pre></figure>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) set $i = 0
(gdb) p w[$i++]
$1 = 12
(gdb)
$2 = 5
(gdb)
$3 = 88</code></pre></figure>
<h1 id="core-files">Core Files</h1>
<p>A core file contains a detailed description of the program’s state when it crashed, such as the contents of the stack(s), CPU’s registers, and values of statically allocated variables.</p>
<p>Usually when a core dump file is generated, it’s placed in the current directory named <code>core</code> or some variation of it. It may be necessary to increase the shell’s core dump resource limit with the command:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span><span class="nb">ulimit</span> -c unlimited
</code></pre></figure>
<p>On systems that use <a href="http://en.wikipedia.org/wiki/Systemd">systemd</a>, such as mine, these files are instead managed by systemd’s journal — they don’t show up in the current directory regardless of the resource limit. The helper program <code>systemd-coredumpctl</code> can be used to extract the core dumps from the journal into individual files:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="c"># based on PID</span>
<span class="nv">$ </span>systemd-coredumpctl dump PID -o outname

<span class="c"># based on binary name</span>
<span class="nv">$ </span>systemd-coredumpctl dump urxvt -o outname
</code></pre></figure>
<p>Core files are useful from a debugging perspective because they provide a starting point for dissecting the program to determine the cause of the crash. They are more useful than simply re-running the program within <abbr title="GNU Debugger">GDB</abbr> because it would be that the bug that caused the crash occurs rarely and randomly.</p>
<p>Core files can be loaded into <abbr title="GNU Debugger">GDB</abbr> by supplying them as a second argument, after the name of the program that generated the core file:</p>
<figure class="codeblock"><pre><code class="highlight language-bash"><span class="nv">$ </span>gdb crasher corefile
</code></pre></figure>
<p>Once loaded, we can run a <code>backtrace</code> to determine the point at which the program crashed. The <code>frame</code> command can be used to navigate the call stack, and typical inspecting commands can be used to analyze the program’s state as it was when it crashed. Breakpoints and similar tools can be established, then the program can be run normally.</p>
<h1 id="threads">Threads</h1>
<p><abbr title="GNU Debugger">GDB</abbr> announces whenever new threads are created. The <code>info threads</code> command can provide summary information about what each of the threads are doing. An asterisk denotes the currently focused thread. Note that some threads may be internal to the threading implementation, such as a Pthreads manager thread.</p>
<p>It’s possible to switch <abbr title="GNU Debugger">GDB</abbr>’s focus to a different thread with the <code>thread</code> command, which takes as argument the thread identifier denoted in <code>info threads</code>.</p>
<p>It’s also possible to provide thread disambiguators to the <code>break</code> command, to pause execution when a specific thread reaches a breakpoint:</p>
<figure class="codeblock"><pre><code class="highlight language-text">(gdb) break linenr thread threadid if condition</code></pre></figure>
<h1 id="abbreviations">Abbreviations</h1>
<p>Many commands have abbreviations which are simpler to enter:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Command</th>
<th style="text-align: center;">Abbreviation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">backtrace</td>
<td style="text-align: center;">bt</td>
</tr>
<tr class="even">
<td style="text-align: left;">break</td>
<td style="text-align: center;">b</td>
</tr>
<tr class="odd">
<td style="text-align: left;">condition</td>
<td style="text-align: center;">cond</td>
</tr>
<tr class="even">
<td style="text-align: left;">continue</td>
<td style="text-align: center;">c</td>
</tr>
<tr class="odd">
<td style="text-align: left;">disable</td>
<td style="text-align: center;">dis</td>
</tr>
<tr class="even">
<td style="text-align: left;">display</td>
<td style="text-align: center;">disp</td>
</tr>
<tr class="odd">
<td style="text-align: left;">enable</td>
<td style="text-align: center;">ena</td>
</tr>
<tr class="even">
<td style="text-align: left;">finish</td>
<td style="text-align: center;">fin</td>
</tr>
<tr class="odd">
<td style="text-align: left;">info</td>
<td style="text-align: center;">i</td>
</tr>
<tr class="even">
<td style="text-align: left;">next</td>
<td style="text-align: center;">n</td>
</tr>
<tr class="odd">
<td style="text-align: left;">print</td>
<td style="text-align: center;">p</td>
</tr>
<tr class="even">
<td style="text-align: left;">ptype</td>
<td style="text-align: center;">pt</td>
</tr>
<tr class="odd">
<td style="text-align: left;">quit</td>
<td style="text-align: center;">q</td>
</tr>
<tr class="even">
<td style="text-align: left;">run</td>
<td style="text-align: center;">r</td>
</tr>
<tr class="odd">
<td style="text-align: left;">step</td>
<td style="text-align: center;">s</td>
</tr>
<tr class="even">
<td style="text-align: left;">tbreak</td>
<td style="text-align: center;">tb</td>
</tr>
<tr class="odd">
<td style="text-align: left;">undisplay</td>
<td style="text-align: center;">undisp</td>
</tr>
<tr class="even">
<td style="text-align: left;">until</td>
<td style="text-align: center;">u</td>
</tr>
</tbody>
</table></div>
  <div class="meta">
    <div class="date"><i class="fa fa-calendar fa-fw"></i> February 18, 2014</div>
    <div class="notes"><i class="fa fa-pencil fa-fw"></i> <a href="..">Notes</a></div>
    <div class="commit"><i class="fa fa-code-fork fa-fw"></i> <a href='https://github.com/blaenk/blaenk.github.io/commits/source/provider/notes/gdb.markdown'>History</a><span class='hash'>, <a href='https://github.com/blaenk/blaenk.github.io/commit/62bfe5c' title='elaborate on print and list'>62bfe5c</a></span></div>
  </div>
</article>


  </div>
  <footer id="footer" class="inner">
    <span id="social">
      <a href="https://github.com/blaenk" title="github"><i class="fa fa-github-alt"></i></a>
      &middot;
      <a href="http://stackoverflow.com/users/101090/jorge-israel-pena" title="stackoverflow"><i class="fa fa-stack-overflow"></i></a>
      &middot;
      <a href="https://twitter.com/blaenk" title="twitter"><i class="fa fa-twitter"></i></a>
      &middot;
      <a href="mailto:jorge.israel.p@gmail.com" title="email"><i class="fa fa-envelope"></i></a>
      &middot;
      <a href="/atom.xml" title="feed"><i class="fa fa-rss-square"></i></a>
    </span>
  </footer>
  
  
  <!-- google analytics -->
  <script async="true" type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-37339861-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>
  <!--MathJax CDN-->
  <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      messageStyle: "none"
    });

    MathJax.Hub.Register.MessageHook('End Process', function() {
      jQuery('#MathJax_Font_Test').empty();
      jQuery('.MathJax_Display').parent('.math').addClass('mobile-math');
    });
  </script>
  <script async="true" type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML">
  </script>
</body>
</html>
